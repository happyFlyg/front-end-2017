
## Vue.js服务端渲染指南

> 注:本指南需要以下最低版本的Vue和支持库:
>
> * vue & vue-server-renderer >= 2.3.0
> * vue-router >= 2.5.0
> * vue-loader >= 12.0.0 & vue-style-loader >= 3.0.0
>
> 如果您以前使用过Vue 2.2的SSR,您会注意到,现在推荐的代码结构[略有不同](https://ssr.vuejs.org/en/structure.html)(新[runInNewContext](https://ssr.vuejs.org/en/api.html#runinnewcontext)选项设置为false)。现有的应用程序可以继续工作,但是推荐迁移到新的指南。

### 什么是服务端渲染(SSR)

`Vue.js`是一个来构建客户端应用程序的框架。默认情况下Vue组件在浏览器中创建、操作DOM。但是也可能在服务器渲染相同的组件作为HTML字符串,直接发送到浏览器,最后在客户端混合静态标记完成交互式应用程序。

服务端渲染的Vue.js应用程序也可以被认为是“同构”或“普遍”。应用程序的大部分代码可以运行在服务器和客户端。

### 为什么是服务端渲染

相比传统的`SPA`(单页面应用程序),SSR的优势主要在于:

* 更好的搜索引擎优化,搜索引擎爬虫将直接看到完全渲染的页面
    
    请注意,到目前为止,谷歌和必应可以索引同步JavaScript应用程序。同步是关键。如果你的应用程序开始为加载程序,然后通过`Ajax`获取内容,爬虫则不会等你完成。这意味着,如果你有内容是异步获取的并且对于搜索引擎优化是很重要的,SSR可能是必要的。

* 更快的`time-to-content`,尤其是在缓慢的互联网或更慢的设备中。服务端不需要等到所有的JavaScript已经下载并执行才开始渲染元素,所以你的用户将会看到一个完整渲染完成的页面。这通常会有更好的用户体验,对于`time-to-content`直接关联转化率是很关键的。

也有一些权衡在使用SSR时要考虑:

* 开发限制。特定于浏览器的代码只能在某些生命周期钩子内使用;一些外部类库可能需要特殊的对待，才能够运行在服务端渲染的应用中。

* 需要更多的参与构建和部署。不像一个完全静态的SPA,可以部署在任何静态文件服务器。服务端渲染的应用需要一个`node.js`服务器可以运行的环境。

* 更多的服务器端负载。在`nodejs`渲染一个完整的应用程序显然要比只提供静态文件对CPU的要求要高,所以如果你期望高流量,准备好相应的服务器负载并且明智地使用缓存策略。

在为你的应用程序使用`SSR`时,第一个问题你应该问是否真的需要它。这主要取决于在应用中`time-to-content`对你是多么重要。例如,如果您正在构建一个内部`dashboard`,在初始加载时的额外几百毫秒则无关紧要,SSR将是一个过度。然而,在`time-to-content`绝对是至关重要的一些情况下,SSR能帮助你实现最好的初始加载性能。

### SSR vs 预渲染

如果你只是调研SSR改善少数营销页面的SEO(例如`/, /about, /contact`等),那么你可以通过`prerendering`代替。相对于使用一个web服务器动态编译HTML,`prerendering`只是在构建时为特定的路由生成静态HTML文件。设置`prerendering`优点是更简单,保持前端是一个完全静态的网站。

如果你使用Webpack,您可以很容易地通过[prerender-spa-plugin](https://github.com/chrisvfritz/prerender-spa-plugin)插件实现`prerendering` 。它与Vue的应用进行了广泛的测试,事实上[作者](https://github.com/chrisvfritz)是Vue核心团队的一员。

### 关于这个指南

本指南主要聚焦于使用`nodejs`的服务端渲染单页面应用程序。结合`Vue SSR`与其他后端设置的话题,不包括在本指南。

本指南将会非常深入并且假设您已经熟悉Vue.js本身,对于`nodejs和webpack`都有不错的知识。如果你喜欢高级解决方案,`Nuxt.js `提供了一个平滑的开箱即用体验,你可以试一试。它是建立在相同的Vue技术栈上但是抽象了很多样板,并提供了一些额外的特性,例如生成静态网站。但是如果你需要更直接的控制应用程序的结构，`Nuxt.js `可能不适合。阅读本指南对于更好地理解`SSR`如何工作仍将是有益的。

参考官方[HackerNews](https://github.com/vuejs/vue-hackernews-2.0/)演示对于你阅读是很有帮助的,`HackerNews`使用本指南中所涉及到的技术。

最后,请注意本指南并不是明确的解决方案。我们发现它们运行得很好,但这并不意味着它不会得到改善。他们在将来可能会修改,可以通过提交`PR`随时做出贡献!